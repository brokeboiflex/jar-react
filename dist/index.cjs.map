{"version":3,"file":"index.cjs","sources":["../src/router.tsx"],"sourcesContent":["import { createJSONStorage, persist, StateStorage } from \"zustand/middleware\";\r\nimport { create } from \"zustand\";\r\nimport { ReactNode, Fragment, isValidElement } from \"react\";\r\nexport interface RouterProps {\r\n  children: ReactNode;\r\n  routerStore: () => RouterState;\r\n}\r\nexport interface RouteProps {\r\n  path: string;\r\n  component: ReactNode;\r\n}\r\n\r\nexport interface RouterState {\r\n  history: string[];\r\n  canGoBack: boolean;\r\n  location: string;\r\n  navigate: (route: string) => void;\r\n  goBack: () => void;\r\n  clearHistory: () => void;\r\n}\r\n\r\nexport interface LinkProps {\r\n  to: string;\r\n  children: ReactNode;\r\n}\r\n\r\nexport function createLink(routerStore: () => RouterState) {\r\n  return function Link({ to, children }: LinkProps) {\r\n    const { navigate } = routerStore();\r\n    return (\r\n      <a\r\n        href=\"\"\r\n        onClick={(e) => {\r\n          e.preventDefault();\r\n          navigate(to);\r\n        }}\r\n      >\r\n        {children}\r\n      </a>\r\n    );\r\n  };\r\n}\r\nexport function createRouterStore(\r\n  storage?: StateStorage,\r\n  key?: string\r\n): () => RouterState {\r\n  // @ts-ignore\r\n\r\n  if (storage) {\r\n    return create<RouterState>()(\r\n      persist(\r\n        (set) => ({\r\n          history: [\"/\"],\r\n          location: \"/\", // Default route\r\n          canGoBack: false,\r\n          navigate: (route: string) =>\r\n            set((state: RouterState) => ({\r\n              history: [...state.history, route],\r\n              location: route,\r\n              canGoBack: history.length > 1,\r\n            })),\r\n          goBack: () =>\r\n            set((state: RouterState) => ({\r\n              location: state.history[state.history.length - 2],\r\n              history: [...state.history].slice(0, -1),\r\n              canGoBack: history.length > 1,\r\n            })),\r\n          clearHistory: () =>\r\n            set(() => ({\r\n              history: [\"/\"],\r\n              location: \"/\",\r\n              canGoBack: false,\r\n            })),\r\n        }),\r\n        {\r\n          name: `router-storage${key ? \"-\" + key : \"\"}`,\r\n          storage: createJSONStorage(() => storage),\r\n        }\r\n      )\r\n    );\r\n  } else {\r\n    return create<RouterState>()((set) => ({\r\n      history: [\"/\"],\r\n      canGoBack: false,\r\n      location: \"/\", // Default route\r\n      navigate: (route: string) =>\r\n        set((state: RouterState) => ({\r\n          history: [...state.history, route],\r\n          location: route,\r\n          canGoBack: history.length > 1,\r\n        })),\r\n      goBack: () =>\r\n        set((state: RouterState) => ({\r\n          location: state.history[state.history.length - 2],\r\n          history: [...state.history].slice(0, -1),\r\n          canGoBack: history.length > 1,\r\n        })),\r\n      clearHistory: () =>\r\n        set(() => ({\r\n          history: [\"/\"],\r\n          location: \"/\",\r\n          canGoBack: false,\r\n        })),\r\n    }));\r\n  }\r\n}\r\nexport function Router({ children, routerStore }: RouterProps) {\r\n  const { location } = routerStore();\r\n\r\n  // Filter children to get Route components\r\n  const routes = Array.isArray(children) ? children : [children];\r\n  const routeElements = routes.filter(\r\n    (child) => isValidElement(child) && (child as any).type === Route\r\n  );\r\n\r\n  // Find the component that matches the current route\r\n  const currentRoute = routeElements.find((route) => {\r\n    const routeProps = (route as any).props as RouteProps;\r\n    return routeProps.path === location;\r\n  });\r\n\r\n  return currentRoute ? (\r\n    <Fragment key={location}>{(currentRoute as any).props.component}</Fragment>\r\n  ) : null;\r\n}\r\n\r\n// Route component\r\n// @ts-ignore\r\nexport function Route({ path, component }: RouteProps) {\r\n  return null;\r\n}\r\n"],"names":["Route","_ref3","_ref2","children","location","routerStore","currentRoute","Array","isArray","filter","child","isValidElement","type","find","route","props","path","_jsx","jsx","Fragment","component","_ref","to","navigate","href","onClick","e","preventDefault","storage","key","create","persist","set","history","canGoBack","state","concat","length","goBack","slice","clearHistory","name","createJSONStorage"],"mappings":"oHAgIgBA,EAAKC,GACnB,OACF,IAAA,yCAxBsBC,GAAuC,IAApCC,EAAQD,EAARC,SACfC,GAAaC,EADuBH,EAAXG,eACzBD,SASFE,GANSC,MAAMC,QAAQL,GAAYA,EAAW,CAACA,IACxBM,OAC3B,SAACC,gBAAK,OAAKC,EAAcA,eAACD,IAAWA,EAAcE,OAASZ,CAAK,GAIhCa,KAAK,SAACC,GAEvC,OADoBA,EAAcC,MAChBC,OAASZ,CAC7B,GAEA,OAAOE,EACLW,EAACC,IAAAC,EAAQA,mBAAkBb,EAAqBS,MAAMK,WAAvChB,GACb,IACN,8BAlG2BC,GACzB,OAAgB,SAAIgB,OAAGC,EAAED,EAAFC,GAAInB,EAAQkB,EAARlB,SACjBoB,EAAalB,IAAbkB,SACR,OACEN,EACEC,IAAA,IAAA,CAAAM,KAAK,GACLC,QAAS,SAACC,GACRA,EAAEC,iBACFJ,EAASD,EACX,EAECnB,SAAAA,GAGP,CACF,qCAEEyB,EACAC,GAIA,OAAID,EACKE,EAAMA,QAANA,CACLC,EAAAA,QACE,SAACC,GAAG,MAAM,CACRC,QAAS,CAAC,KACV7B,SAAU,IACV8B,WAAW,EACXX,SAAU,SAACT,GAAa,OACtBkB,EAAI,SAACG,GAAwB,MAAA,CAC3BF,QAAO,GAAAG,OAAMD,EAAMF,QAASnB,CAAAA,IAC5BV,SAAUU,EACVoB,UAAWD,QAAQI,OAAS,EAC7B,EAAE,EACLC,OAAQ,WACN,OAAAN,EAAI,SAACG,GAAkB,MAAM,CAC3B/B,SAAU+B,EAAMF,QAAQE,EAAMF,QAAQI,OAAS,GAC/CJ,QAAS,GAAAG,OAAID,EAAMF,SAASM,MAAM,GAAI,GACtCL,UAAWD,QAAQI,OAAS,EAC7B,EAAE,EACLG,aAAc,WAAA,OACZR,EAAI,WAAO,MAAA,CACTC,QAAS,CAAC,KACV7B,SAAU,IACV8B,WAAW,EACZ,EAAE,EACN,EACD,CACEO,KAAuBZ,kBAAAA,EAAM,IAAMA,EAAM,IACzCD,QAASc,EAAAA,kBAAkB,WAAM,OAAAd,CAAO,MAKvCE,EAAMA,QAANA,CAAsB,SAACE,SAAS,CACrCC,QAAS,CAAC,KACVC,WAAW,EACX9B,SAAU,IACVmB,SAAU,SAACT,GACT,OAAAkB,EAAI,SAACG,GAAkB,MAAM,CAC3BF,QAAO,GAAAG,OAAMD,EAAMF,QAAO,CAAEnB,IAC5BV,SAAUU,EACVoB,UAAWD,QAAQI,OAAS,EAC7B,EAAE,EACLC,OAAQ,WACN,OAAAN,EAAI,SAACG,GAAkB,MAAM,CAC3B/B,SAAU+B,EAAMF,QAAQE,EAAMF,QAAQI,OAAS,GAC/CJ,QAAS,GAAAG,OAAID,EAAMF,SAASM,MAAM,GAAI,GACtCL,UAAWD,QAAQI,OAAS,EAC7B,EAAE,EACLG,aAAc,WAAA,OACZR,EAAI,WAAO,MAAA,CACTC,QAAS,CAAC,KACV7B,SAAU,IACV8B,WAAW,EACZ,EAAE,EACN,EAEL"}